---
sidebar_position: 4
---
# Harmonising the variants

Each variant is harmonised by aligning it with a reference dataset - Ensembl VCF. The harmonisation process ensures allele consistency and corrects the orientation of alleles to the forward strand. This step ensures that all variants are aligned and ready for downstream analysis.

Query against the reference: Each variant is matched against the Ensembl VCF reference using its chromosome, base pair location, and alleles (effect allele and other allele). Based on this comparison, the following actions are taken:
### 1. Keeping the record as-is
* If the variant is already correctly oriented according to the reference (i.e., both effect and other alleles match the reference forward strand), no changes are made, and the variant is kept as-is.
### 2. Orientating to the reference strand
* If the alleles are oriented to the reverse strand, the pipeline reverse complements both the effect and other alleles to align them with the forward strand of the reference. This ensures that the variant is reported in the correct orientation.
### 3. Flipping the effect and other alleles
* If the effect and other alleles are flipped compared to the reference, the pipeline flips the alleles accordingly. This flip means the effect allele and other allele are swapped to match the reference. Along with flipping the alleles, associated metrics such as beta, odds ratio (OR), Z-score, confidence interval (CI) for the odds ratio, and effect allele frequency (EAF) are inverted to reflect the change in allelic direction.

For flipped variants:
```math
\begin{aligned}
\beta &= - \beta_{\text{original}} \\
\text{odds\_ratio} &= \frac{1}{OR_{\text{original}}} \\
\text{ci\_upper} &= \frac{1}{\text{ci\_lower}_{\text{original}}} \\
\text{ci\_lower} &= \frac{1}{\text{ci\_upper}_{\text{original}}} \\
\text{effect\_allele\_frequency} &= 1 - EAF_{\text{original}} \\
\end{aligned}
```
